<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.27.xsd"
        objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">
    <changeSet id="1726948131519-1" author="kebab">
        <createTable tableName="CommunicationMessages">
            <column autoIncrement="true" name="Id" type="INT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_CommunicationMessages"/>
            </column>
            <column name="CommunicationId" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="SenderId" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="Message" type="NVARCHAR(250)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1726948131519-2" author="kebab">
        <createTable tableName="UserCommunication">
            <column autoIncrement="true" name="Id" type="INT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_UserCommunication"/>
            </column>
            <column name="User1" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="User2" type="INT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="User1Unread" type="INT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="User2Unread" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1726948131519-3" author="kebab">
        <createTable tableName="Users">
            <column autoIncrement="true" name="Id" type="INT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_Users"/>
            </column>
            <column name="Name" type="NVARCHAR(30)">
                <constraints nullable="false"/>
            </column>
            <column name="Lastname" type="NVARCHAR(30)">
                <constraints nullable="false"/>
            </column>
            <column name="Email" type="NVARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="PasswordHash" type="BLOB(2147483647)">
                <constraints nullable="false"/>
            </column>
            <column name="PasswordSalt" type="BLOB(2147483647)">
                <constraints nullable="false"/>
            </column>
            <column name="PhoneNumber" type="NVARCHAR(30)">
                <constraints nullable="false"/>
            </column>
            <column name="WorkerType" type="TINYINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1726948131519-4" author="kebab">
        <createTable tableName="WorkerTypes">
            <column name="Id" type="TINYINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_WorkerTypes"/>
            </column>
            <column name="TypeName" type="NCHAR(20)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1726948131519-5" author="kebab">
        <addUniqueConstraint columnNames="Email" constraintName="UQ_Email" tableName="Users"/>
    </changeSet>
    <changeSet id="1726948131519-6" author="kebab">
        <addUniqueConstraint columnNames="PhoneNumber" constraintName="UQ_PhoneNumber" tableName="Users"/>
    </changeSet>
    <changeSet id="1726948131519-7" author="kebab">
        <addForeignKeyConstraint baseColumnNames="CommunicationId" baseTableName="CommunicationMessages"
                                 constraintName="FK_CommunicationMessages_UserCommunication" onDelete="NO ACTION"
                                 referencedColumnNames="Id" referencedTableName="UserCommunication"/>
    </changeSet>
    <changeSet id="1726948131519-8" author="kebab">
        <addForeignKeyConstraint baseColumnNames="SenderId" baseTableName="CommunicationMessages"
                                 constraintName="FK_CommunicationMessages_Users" onDelete="NO ACTION"
                                 referencedColumnNames="Id" referencedTableName="Users"/>
    </changeSet>
    <changeSet id="1726948131519-9" author="kebab">
        <addForeignKeyConstraint baseColumnNames="User1" baseTableName="UserCommunication"
                                 constraintName="FK_UserCommunication_Users1" onDelete="NO ACTION"
                                 referencedColumnNames="Id" referencedTableName="Users"/>
    </changeSet>
    <changeSet id="1726948131519-10" author="kebab">
        <addForeignKeyConstraint baseColumnNames="User2" baseTableName="UserCommunication"
                                 constraintName="FK_UserCommunication_Users2" onDelete="NO ACTION"
                                 referencedColumnNames="Id" referencedTableName="Users"/>
    </changeSet>
    <changeSet id="1726948131519-11" author="kebab">
        <addForeignKeyConstraint baseColumnNames="WorkerType" baseTableName="Users"
                                 constraintName="FK_Users_WorkerTypes" onDelete="NO ACTION" referencedColumnNames="Id"
                                 referencedTableName="WorkerTypes"/>
    </changeSet>

</databaseChangeLog>